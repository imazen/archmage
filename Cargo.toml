[workspace]
members = [".", "archmage-macros", "xtask"]

[package]
name = "archmage"
version = "0.1.0"
edition = "2024"
rust-version = "1.89"
license = "MIT OR Apache-2.0"
description = "Safely invoke your intrinsic power, using the tokens granted to you by the CPU. Cast primitive magics faster than any mage alive."
repository = "https://github.com/imazen/archmage"
keywords = ["simd", "avx", "neon", "performance", "safe"]
categories = ["development-tools", "hardware-support", "no-std"]

[features]
default = ["std", "macros"]
std = []
macros = ["dep:archmage-macros"]
# Optional modules
ops = []                               # Safe load/store operations
composite = ["ops"]                    # Transpose, dot product, horizontal ops
# Integration features
wide = ["dep:wide"]
safe-simd = ["dep:safe_unaligned_simd"]
# All optional modules
full = ["ops", "composite", "wide", "safe-simd"]
# Nightly-only: use #[inline(always)] with #[target_feature] in generated wrappers.
# Requires #![feature(target_feature_inline_always)] in the crate using archmage.
# Can reduce register spills in hot SIMD code by 10-20%.
nightly-inline-always = []

[dependencies]
# Proc-macro crate for #[arcane] attribute
archmage-macros = { version = "0.1.0", path = "archmage-macros", optional = true }
# Optional integrations
wide = { version = "1.1.1", optional = true }
safe_unaligned_simd = { version = "0.2.3", optional = true, features = ["avx512"] }

[dev-dependencies]
criterion = { version = "0.5", features = ["html_reports"] }
trybuild = "1.0"

[[bench]]
name = "tokens"
harness = false

[package.metadata.docs.rs]
all-features = true
rustdoc-args = ["--cfg", "docsrs"]
